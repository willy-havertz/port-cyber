services:
  - type: web
    name: port-cyber-backend
    runtime: python
    rootDir: backend
    startCommand: "gunicorn -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:$PORT main:app"
    buildCommand: "pip install -r requirements.txt && alembic upgrade heads && python seed_writeups.py"
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: ADMIN_PASSWORD
        sync: false
      - key: SECRET_KEY
        sync: false
      - key: FRONTEND_URL
        value: https://port-cyber.vercel.app
      - key: ENVIRONMENT
        value: production
      - key: GEMINI_API_KEY
        sync: false
      - key: AI_GENERATION_ENABLED
        value: true

  # Separate scanner service (deploy from port-cyber-scanner repo)
  # Uncomment and configure after pushing scanner repo to GitHub
  # - type: web
  #   name: port-cyber-scanner
  #   runtime: python
  #   buildCommand: "pip install -r requirements.txt"
  #   startCommand: "gunicorn -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:$PORT main:app"
  #   envVars:
  #     - key: SECRET_KEY
  #       sync: false
  #     - key: ADMIN_USERNAME
  #       value: admin
  #     - key: ADMIN_PASSWORD
  #       sync: false
  #     - key: DATABASE_URL
  #       value: sqlite:///./scanner.db
  #     - key: SCANNER_ALLOW_PRIVATE
  #       value: false
  #     - key: SCANNER_MAX_SCANS_PER_USER
  #       value: 5
  #     - key: SCANNER_RATE_WINDOW_MINUTES
  #       value: 60
  #     - key: ENVIRONMENT
  #       value: production
