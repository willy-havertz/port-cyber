name: Keep Backend Awake

# DISABLED - Using UptimeRobot for more reliable pings instead
# Uncomment the schedule below if you want to re-enable GitHub Actions pings
on:
  # schedule:
  #   - cron: "*/10 * * * *"
  workflow_dispatch: # Keep manual trigger for testing

jobs:
  ping:
    runs-on: ubuntu-latest
    continue-on-error: true # Don't mark workflow as failed even if step fails
    steps:
      - name: Ping Render backend to keep it awake
        continue-on-error: true # Don't fail the workflow
        run: |
          ENDPOINT="https://port-cyber-backend.onrender.com/health"
          MAX_ATTEMPTS=3
          TIMEOUT=90

          for i in $(seq 1 $MAX_ATTEMPTS); do
            echo "Ping attempt $i of $MAX_ATTEMPTS: $ENDPOINT"
            
            RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" "$ENDPOINT" --max-time $TIMEOUT 2>/dev/null || echo "000")
            echo "HTTP status: $RESPONSE"
            
            if [ "$RESPONSE" = "200" ]; then
              echo "âœ… Backend is awake."
              exit 0
            fi
            
            if [ $i -lt $MAX_ATTEMPTS ]; then
              echo "Retrying in 30s..."
              sleep 30
            fi
          done

          echo "::notice::Backend ping unsuccessful but this is normal for free tier cold starts."
          exit 0  # Always exit successfully to avoid failure emails
